-- dim_customer --- 
create materialized view gold.dim_customer as (
select 
row_number() over(order by ci.cst_id) as customer_key,  -- surrogate key
ci.cst_id as  customer_id,   -- id untuk fact_crm_details --
ci.cst_key as customer_number,  -- id c--
ci.cst_firstname as firs_tname,
ci.cst_lastname as last_name,
case -- data integration --
when  ci.cst_gndr  = 'n/a' then ec.gen 
when ci.cst_gndr != ec.gen then cst_gndr 
else cst_gndr
end as gender,
el.cntry as  country,
ec.bdate as birthdate, -- bisnis logic -- , 
ci.cst_marital_status as marital_status,
ci.cst_create_date as create_date
from silver."crm_cust_info" ci left join silver."erp_cust_az12" ec on ci.cst_key = ec.cid
left join silver."erp_loc_a101" el on ci.cst_key = el.cid
)

-- dim_product --
create materialized view gold.dim_products as (
select 
row_number() over(order by pd.sls_prd_key) as product_key, --surrogate key--
pd.sls_prd_key as product_id,
pd.prd_id  as product_number,
pd.prd_nm as product_name,
pd.prd_cat_key as category_id,
epc.cat as category,
epc.subcat as sub_category,
epc.maintenance,
pd.prd_cost as cost,
pd.prd_line as product_line,
pd.prd_start_dt as start_date
from silver."crm_prd_info" pd left join silver."erp_px_cat_g1v2" epc on pd.prd_cat_key = epc.id
where pd.prd_end_dt is null
)

-- fact sales --
select 
sls_ord_num,
sls_prd_key,
sls_cust_id,
sls_order_dt,
sls_ship_dt, 
sls_due_dt, 
sls_sales, 
sls_quantity, 
sls_price
from silver."crm_sales_details"
left join 
